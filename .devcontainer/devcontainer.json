{
    // =========================================================================
    // fq-compressor Dev Container Configuration
    // =========================================================================
    // Requirement 7.6: Containerized development environment
    //
    // Recommended Development Environment:
    //   - GCC 15 + libstdc++ (production builds)
    //   - Clang 21 + libc++ (development/debugging)
    //   - CMake 4.x
    //   - Conan 2.x
    //
    // Usage:
    //   1. Open VS Code in WSL2 (recommended)
    //   2. Use "Reopen in Container" command
    //   3. Build with: cmake --preset clang-debug && cmake --build --preset clang-debug
    // =========================================================================
    "name": "fq-compressor Dev",
    "dockerComposeFile": [
        "../docker/docker-compose.yml"
    ],
    "service": "dev",
    "runServices": [
        "dev"
    ],
    "workspaceFolder": "/workspace",
    "shutdownAction": "stopCompose",
    "remoteUser": "developer",
    "initializeCommand": "bash ${localWorkspaceFolder}/.devcontainer/scripts/host-prepare.sh",
    "overrideCommand": true,

    // =========================================================================
    // DevContainer Features - 标准化工具安装
    // =========================================================================
    "features": {
        "ghcr.io/devcontainers/features/common-utils:2": {
            "installZsh": true,
            "configureZshAsDefaultShell": false,
            "installOhMyZsh": true,
            "upgradePackages": false,
            "username": "developer"
        }
    },

    // =========================================================================
    // Volume Mounts - 宿主机配置映射
    // =========================================================================
    "mounts": [
        "type=bind,source=${localEnv:HOME}/.ssh,target=/home/developer/.ssh,readonly",
        "type=bind,source=${localEnv:HOME}/.fqcompressor-host-gitconfig,target=/tmp/host-gitconfig,readonly",
        "type=bind,source=${localEnv:HOME}/.fqcompressor-host-claude,target=/tmp/host-claude,readonly",
        "type=bind,source=${localEnv:HOME}/.fqcompressor-host-codex,target=/tmp/host-codex,readonly",
        "type=bind,source=${localEnv:SSH_AUTH_SOCK},target=/ssh-agent"
    ],

    // =========================================================================
    // Environment Variables
    // =========================================================================
    "remoteEnv": {
        "SSH_AUTH_SOCK": "/ssh-agent",
        "WSL_DISTRO_NAME": "${localEnv:WSL_DISTRO_NAME}",
        "WORKSPACE": "/workspace",
        "EDITOR": "code --wait",
        "VISUAL": "code --wait"
    },

    // =========================================================================
    // Port Forwarding
    // =========================================================================
    "forwardPorts": [
        8080,
        2222
    ],
    "portsAttributes": {
        "2222": {
            "label": "SSH",
            "onAutoForward": "silent"
        },
        "8080": {
            "label": "HTTP",
            "onAutoForward": "notify"
        }
    },

    // =========================================================================
    // Lifecycle Commands
    // =========================================================================
    "postCreateCommand": "bash /workspace/.devcontainer/scripts/container-setup.sh create",
    "postStartCommand": "bash /workspace/.devcontainer/scripts/container-setup.sh start",
    "postAttachCommand": "bash /workspace/.devcontainer/scripts/container-setup.sh attach",

    // =========================================================================
    // VS Code Customizations
    // =========================================================================
    "customizations": {
        "vscode": {
            "settings": {
                // 终端配置
                "remote.containers.copyGitConfig": false,
                "terminal.integrated.defaultProfile.linux": "bash",
                "terminal.integrated.profiles.linux": {
                    "bash": {
                        "path": "/bin/bash"
                    },
                    "zsh": {
                        "path": "/bin/zsh"
                    }
                },

                // CMake 配置
                "cmake.generator": "Ninja",
                "cmake.useCMakePresets": "always",
                "cmake.configureOnOpen": false,
                "cmake.copyCompileCommands": "/workspace/compile_commands.json",
                "cmake.configureSettings": {
                    "CMAKE_EXPORT_COMPILE_COMMANDS": "ON"
                },
                "cmake.buildDirectory": "${workspaceFolder}/build/${buildPreset}",

                // Clangd 配置 (C++ 智能提示)
                "clangd.path": "/usr/bin/clangd",
                "clangd.arguments": [
                    "--background-index",
                    "--clang-tidy",
                    "--completion-style=detailed",
                    "--header-insertion=never",
                    "--suggest-missing-includes",
                    "--all-scopes-completion",
                    "--pch-storage=memory",
                    "--query-driver=/usr/bin/g++,/usr/bin/gcc,/usr/bin/clang++,/usr/bin/clang"
                ],
                "clangd.checkUpdates": false,

                // 编辑器配置
                "editor.formatOnSave": true,
                "editor.defaultFormatter": "llvm-vs-code-extensions.vscode-clangd",
                "[cpp]": {
                    "editor.defaultFormatter": "llvm-vs-code-extensions.vscode-clangd"
                },
                "[c]": {
                    "editor.defaultFormatter": "llvm-vs-code-extensions.vscode-clangd"
                },

                // 文件配置
                "files.associations": {
                    "*.h": "cpp",
                    "*.hpp": "cpp",
                    "CMakeLists.txt": "cmake",
                    "conanfile.py": "python"
                },
                "files.trimTrailingWhitespace": true,
                "files.insertFinalNewline": true,

                // 搜索排除
                "search.exclude": {
                    "**/build": true,
                    "**/cmake-build-*": true,
                    "**/.conan2": true,
                    "**/.ccache": true
                }
            },
            "extensions": [
                // C++ 开发
                "ms-vscode.cmake-tools",
                "llvm-vs-code-extensions.vscode-clangd",
                "vadimcn.vscode-lldb",
                "twxs.cmake",
                "jeff-hykin.better-cpp-syntax",

                // 代码质量
                "streetsidesoftware.code-spell-checker",
                "EditorConfig.EditorConfig",

                // Docker & 容器
                "ms-azuretools.vscode-docker",

                // Git
                "eamodio.gitlens",
                "mhutchie.git-graph",

                // 实用工具
                "yzhang.markdown-all-in-one",
                "redhat.vscode-yaml"
            ]
        }
    }
}